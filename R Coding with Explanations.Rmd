---
title: "Bunbury Offshore Wind Popwer Opportunity Assessment"
author: "Kelsea Dundon"
date: "`r Sys.Date()`"
output: html_document
---
# Bunbury Offshore Wind Popwer Opportunity Assessment
## The Wind Resource
### Wind Data Sources
wind atlas
Data modelled at 150 m

### Wind Data Analysis
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(usethis)
library(gitcreds)
library (openair)
library(openairmaps)
library(gplots)
library(lubridate)
library(hms)
library(ggplot2)
library(tibble)
library(fitdistrplus)
library(bReeze)
library(RColorBrewer)
library(XML)
library(RgoogleMaps)
```

```{r, include=FALSE}
# Setup theme for plots
blue_theme <- function() {
  theme(
    panel.border = element_rect(colour = "black", fill = NA, linetype = 2),
    panel.background = element_rect(fill = "aliceblue"),
    panel.grid.major.x = element_line(colour = "lightgrey", linetype = 1, size = 0.5),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y =  element_line(colour = "lightgrey", linetype = 1, size = 0.5),
    panel.grid.minor.y = element_blank(),
    axis.text = element_text(colour = "black", size = 8),
    axis.title = element_text(colour = "black", face = "bold", size = 10),
    axis.ticks = element_line(colour = "black"),
    legend.key.size = unit(0.3, 'cm'), 
    legend.key.height = unit(0.3, 'cm'), 
    legend.key.width = unit(0.3, 'cm'), 
    legend.title = element_text(size = 10, face = "bold"), 
    legend.text = element_text(size = 8)
  )
}

```

#### Import data & Check for errors
* No NAN's, NA's or blank cells
* Max wind speed in data is 29.06 m/s, minimum is 0.2769
* In observational data wind speeds less than 0.5m/s may not be used in analysis, particularly if they are paired with directional data as the direction may not have been accurately recorded at such a low wind speed. However this is modelled data and directions are not included/will not be used so the data will be retained in the analysis. 
```{r}
# Import and inspect the data
Wind_Data_Raw <- read.table('Wind_Data_Lat-33_Long+114.csv', header = TRUE, sep = ',', quote = "")
head(Wind_Data_Raw)
```
From above we can see the data format is pretty simple, a datetime column and a windspeed. 
```{r}
# Check for missing data in datetime column
is.nan(Wind_Data_Raw$datetime)["TRUE"]
is.na(Wind_Data_Raw$datetime)["TRUE"]
Wind_Data_Raw$datetime[""]

# Check for missing data in windspeed column, or for wind speeds less than 0.5m/s
is.nan(Wind_Data_Raw$wind_speed)["TRUE"]
is.na(Wind_Data_Raw$wind_speed)["TRUE"]

# Max and min wind speeds (will give an idea on if there is problematic data to be further investigated)
max(Wind_Data_Raw$wind_speed)
min(Wind_Data_Raw$wind_speed)
```

#### Data Preparation
I will add columns that will let me split out the data better;
  * Year, 
  * month, 
  * day of year, 
  * hour of day, 
  * season (Dec/Jan/Feb = Summer, Mar/Apr/May = Autumn, Jun/Jul/Aug = Winter, Sep/Oct/Nov = Spring )

```{r}
# Convert datetime to POSIXct format
Wind_Data_Raw$datetime <- as.POSIXct(Wind_Data_Raw$datetime, format = "%d/%m/%Y %H:%M", tz = "UTC")

# Create new columns for Date, Hour, Year, Month, Season
Wind_Data <- data.frame(Wind_Data_Raw[c(1:10000),])
Wind_Data$Date <- as.Date(Wind_Data$datetime)
Wind_Data$Hour <- hour(Wind_Data$datetime)
Wind_Data$Year <- year(Wind_Data$Date)
Wind_Data$Month <- month(Wind_Data$Date)

# Create a column for wind direction (data does not contain this but the bReeze package will need it)
Wind_Data$Dir <- 1

# Label seasons
indx <- setNames(rep(c("summer", "autumn", "winter", "spring"), each = 3), c(12, 1:11))
Wind_Data$Season <- unname(indx[as.character(Wind_Data$Month)])

head(Wind_Data)
dim(Wind_Data)
```

#### Wind Characterisation
```{r}
# All data 
ggplot(data = Wind_Data) +
  geom_histogram(mapping = aes(x=wind_speed), binwidth=0.5, color="black", fill="gray") +
  labs(title = 'Hourly Wind Speed Distribution') +
  xlab('Wind Speed (m/s)') +
  blue_theme()

# Calculate the scale and shape factors from fitting a Weibull Distribution
fw <- fitdist(Wind_Data$wind_speed, "weibull")
summary(fw)
```
#### Seasonal Wind Variation
```{r}
# Separated by season
Wind_Winter <- Wind_Data[Wind_Data$Season == "winter", ]
ggplot(data = Wind_Winter) +
  geom_histogram(mapping = aes(x=wind_speed) , binwidth=0.5, color="black", fill="gray") +
  labs(title = 'Hourly Wind Speed Distribution in Winter') +
  xlab('Wind Speed (m/s)') +
  blue_theme()

Wind_Summer <- Wind_Data[Wind_Data$Season == "summer", ]
ggplot(data = Wind_Summer) +
  geom_histogram(mapping = aes(x=wind_speed) , binwidth=0.5, color="black", fill="gray") +
  labs(title = 'Hourly Wind Speed Distribution in Summer') +
  xlab('Wind Speed (m/s)') +
  blue_theme()

Wind_Autumn <- Wind_Data[Wind_Data$Season == "autumn", ]
ggplot(data = Wind_Autumn) +
  geom_histogram(mapping = aes(x=wind_speed) , binwidth=0.5, color="black", fill="gray") +
  labs(title = 'Hourly Wind Speed Distribution in Autumn') +
  xlab('Wind Speed (m/s)') +
  blue_theme()

Wind_Spring <- Wind_Data[Wind_Data$Season == "spring", ]
ggplot(data = Wind_Spring) +
  geom_histogram(mapping = aes(x=wind_speed) , binwidth=0.5, color="black", fill="gray") +
  labs(title = 'Hourly Wind Speed Distribution in Spring') +
  xlab('Wind Speed (m/s)') +
  blue_theme()
```

```{r}
# Lets show the seasonal differences
ggplot(data = Wind_Data) +
  geom_density(aes(x=wind_speed, fill=Season), alpha=0.3)

ggplot(data = Wind_Data) +
  geom_boxplot(aes(x=wind_speed, fill=Season))

# Fitting the Weibull Distribution to the seasonal data to see how the shape (a) and scale (k) factors vary
Data_summer <- subset(Wind_Data, Season == "summer")
fw_summer <- fitdist(Data_summer$wind_speed, "weibull")
summary(fw_summer)

Data_winter <- subset(Wind_Data, Season == "winter")
fw_winter <- fitdist(Data_winter$wind_speed, "weibull")
summary(fw_winter)

Data_spring <- subset(Wind_Data, Season == "spring")
fw_spring <- fitdist(Data_spring$wind_speed, "weibull")
summary(fw_spring)

Data_autumn <- subset(Wind_Data, Season == "autumn")
fw_autumn <- fitdist(Data_autumn$wind_speed, "weibull")
summary(fw_autumn)
```

#### Diurnal Variation
```{r}
# Calculate the mean wind speed for each hour of the day in each season
Mean_hr_szn <- aggregate(data = Wind_Data, wind_speed ~ Season + Hour, mean)
print(Mean_hr_szn)

#Can now join into the existing dataframe, or just use seperately for this graph
# Graph together
ggplot(data = Mean_hr_szn) +
  geom_line(aes(x=Hour, y=wind_speed, color=Season))
```

#### Synoptic Variations
These variations occur on the multi-day scale and are usually associated with weather formations, they are less predictable from historical data, but the use of data with meteorological forecasting can significantly increase predictability. Of use at this stage of analysis is an understanding of the frequency of the variations (i.e. on average are most weather formations 3 days, 5 days, 14 day events). The data source currently being used does not contain direction data, which will make changes associated with large weather formations difficult to identify. It is recommended that this analysis is done on another data source and so it will be ommitted at this stage. 

#### Turbulence
As this data is on the hourly scale it is not possible to see the impact of turbulence. 
For this analysis a Turbulence Intensity will be assumed. 
This is acceptable at this stage as the location is offshore, reducing topographical impacts of turbulence,

#### Power Density
Apply Betz limit
Assume a standard air density of 1.225 kg/mÂ³
```{r}
p <- 1.225
Cpmax = 16/27
Um = mean(Wind_Data$wind_speed)
Um
Um_summer = mean(Data_summer$wind_speed)
Um_summer

Um_winter = mean(Data_winter$wind_speed)
Um_winter

Um_spring = mean(Data_spring$wind_speed)
Um_spring

Um_autumn = mean(Data_autumn$wind_speed)
Um_autumn

# Wind Power Density (W/m^2)
Pideal = (1/2) * p * Um^3
Pideal

# Maximum Power Density Available (W/m^2)
Pmax = Cpmax * Pideal
Pmax
```

## Turbine Power Curves
The bReeze package contains many power curves in .wtg and .pow formats. 
```{r}
# Pulling out all of the power-curves within bReeze
bReeze_files <- list.files(system.file(package = 'bReeze'), recursive = T, full.names = T)
# This generated a list of all the files, now I'll exclude those that are not power curve file names. PC files start from line 23 and end on 115
pc_files1 <- bReeze_files[c(23:115)]
pc_files2 <- substr(pc_files1, 67,100 )
pc_files2
```
For this analysis offshore turbines will be used, the first list below is commercially available/installed turbines, the second list is protoype turbines (some of which are being installed in wind farms currently under construction, and the third is concept offshore turbines.For currently installed turbines the list has been refined to only wind farms commissioned after 2020 to exclude turbines that have been superseded by the advance in technology. 

### Commercially used:
MHI Vestas V164-9.5 MW
MHI Vestas V174-9.5 MW
MHI Vestas V164-10 MW
Vestas V236-15MW
Siemens Gamesa SG-14-222 DD 14.7MW
Siemens Gamesa SWT-4.0-146
Siemens Gamesa SWT-7.0-154
Siemens Gamesa SG 8.0-167 DD
Siemens Gamesa SWT-8.4-167
Siemens Gamesa 11.0-200 DD
Siemens Gamesa SG 14-236 DD
Siemens Gamesa 14-222 DD
GE Haliade 150-6MW
GE Wind Energy Haliade-X 13MW or 13.6MW
Mingyang Wind Power MySE 12-242 12MW
Mingyang MY-5.5 MW
MingYang MySE5.5-155
Mingyang MySE6.45-180
CSIC Haizhuang H220-8.35
MySE6.8-158
MySE8.3-180

### Prototypes:
Siemens Gamesa SG DD-276 21.5MW
Mingyang Wind Power MySE18.X-20MW 18.X to 20MW
Dongfang Electric DEW-18MW-260 18MW
Mingyang Wind Power MySE16.0-260 16MW
Goldwind GWH252 16MW
GE Wind Energy Haliade-X 14.7

### Concept Designs:
Dongfang Electric DEW-26MW-310
Mingyang Wind Power MySE22MW
CSSC Haizhuang H260-18MW

### Power Curves for Analysis
However most of the turbines listed above, especially the newer and more powerful turbines do not have power curves in the bReeze package, and they are not freely available online. So that this analysis can progress, and consider a range of turbines, all turbines rated 3MW or above from bReeze will be used.
"Enercon_E101_3.0MW.pow" 
"Enercon_E126_7.5MW.pow"
"Enercon_E82_3.0MW.pow"
"Vestas_V164_7.0MW_os.pow"  
"Vestas_V90_3.0MW.pow"          
"Vestas_V112_3MW.pow"
"Leitwind_LTW101_3.0MW.pow"
"Repower_5M_5.0MW.pow" 
"Siemens_SWT-3.6MW-107m.pow"
"Siemens_SWT-3.6MW-120m.pow" 


```{r}
PC_File <- c("Enercon_E101_3.0MW.pow", "Enercon_E126_7.5MW.pow", "Enercon_E82_3.0MW.pow", "Vestas_V164_7.0MW_os.pow", "Vestas_V90_3.0MW.pow", "Vestas_V112_3MW.pow", "Leitwind_LTW101_3.0MW.pow", "Repower_5M_5.0MW.pow", "Siemens_SWT-3.6MW-107m.pow", "Siemens_SWT-3.6MW-120m.pow")

# Additional data for the analysis has been sourced from thewindpower.net
Power_Curves <- as.data.frame(PC_File)
Power_Curves$HH_min_m <- c(99,135,59,105,99,84,95,95,80,88)
Power_Curves$HH_max_m <- c(149,135,84,150,149,119,143,117,96,90)
Power_Curves$Rated_Power_MW <- c(3.0,7.5,3.0,7.0,3.05,3.0,3.0,5.08,3.6,3.6)
Power_Curves$Rotor_Dia_m <- c(101,127,82,164,101,112,100.9,126.5,107,120)
Power_Curves$Cutin_speed_ms <- c(2,2.5,2,4,2,3.5,2.7,3.5,3.5,3.5)
Power_Curves$Rated_speed_ms <- c(13,17,17,11,13,15.5,15,14,16.5,12)
Power_Curves$Cutout_speed_ms <- c(25,25,25,25,25,25,25,30,25,25)
Power_Curves$Offshore <- c("no","no","no","yes","no","no","no","yes","yes","yes")
head(Power_Curves)
```

## Wind Power Generation Estimates
Power curves are ready to apply, now the wind data needs to be set-up into the format required by bReeze. 
```{r}
# Convert POSIXct to POSIXlt
Wind_Data$datetime_lt <- as.POSIXlt(Wind_Data$datetime)

# Ensure wind_speed is numeric (just in case)
Wind_Data$wind_speed <- as.numeric(Wind_Data$wind_speed)

# Check set-up before forming set
length(Wind_Data$datetime_lt) == length(Wind_Data$wind_speed)
is.na(Wind_Data$datetime_lt)["TRUE"]
is.na(Wind_Data$wind_speed)["TRUE"]
is.numeric(Wind_Data$wind_speed)
range(Wind_Data$datetime_lt)

# Create placeholders with NAs for missing fields
n <- nrow(Wind_Data)

# Set 'n' to exact number of rows
n <- nrow(Wind_Data)

# Check for any unexpected NA
sum(is.na(Wind_Data$wind_speed))   # Should be 0 ideally
sum(is.na(Wind_Data$datetime_lt))  # Should be 0 ideally

# Build the set
Wind_Data_set <- set(
  height = 150,
  v.avg = Wind_Data$wind_speed, 
  dir.avg = Wind_Data$Dir
)

# Create mast object with POSIXlt timestamp
Wind_Data_mast <- mast(timestamp = Wind_Data$datetime_lt, set = Wind_Data_set, loc = NULL, desc = "Modelled data 150m")

# Check output
Wind_Data_mast

# calculate wind profile 
pf <-  windprofile(mast = Wind_Data_mast, v.set = 1, dir.set=1, num.sectors=12, method=c("hellman", "loglm", "fixed"), alpha=NULL, digits=1, print=TRUE)
day.plot(mast = Wind_Data_mast, set = 1, dir.set = 1, signal = "v.avg")
```
### Evaluation Areas
Now the wind data is prepared we can apply the power curves. I will be looking at the following for each;

  * Annual Energy Production
  * Capacity Factor
  * How does the mean wind speed align with the rated wind speed
  * Energy production over an average day per year/season

#### Enercon E101
```{r}
# Power curve 
pc_1 <- pc(Power_Curves$PC_File[1])
plot(pc_1, cp=TRUE, ct=TRUE)

# Hub Height min & max
hh1_min <- Power_Curves$HH_min_m[1]
hh1_max <- Power_Curves$HH_max_m[1]

# calculate annual energy production with minimum hub height
aep_1_hhmin <- aep(profile = pf, pc = pc_1, hub.h = hh1_min) 
capacity_1_hhmin <- aep_1_hhmin$capacity
AEP_Plot_1_hhmin <- plot(aep_1_hhmin)

# calculate annual energy production with maximum hub height
aep_1_hhmax <- aep(profile = pf, pc = pc_1, hub.h = hh1_max) 
capacity_1_hhmax <- aep_1_hhmax$capacity
AEP_Plot_1_hhmax <- plot(aep_1_hhmax)

# plot energy production over typical day


```

#### Enercon E126
```{r}
# Power curve 
pc_2 <- pc(Power_Curves$PC_File[2])
plot(pc_2, cp=TRUE, ct=TRUE)

# Hub Height min & max
hh2_min <- Power_Curves$HH_min_m[2]
hh2_max <- Power_Curves$HH_max_m[2]

# calculate annual energy production with minimum hub height
aep_2_hhmin <- aep(profile = pf, pc = pc_2, hub.h = hh2_min) 
capacity_2_hhmin <- aep_2_hhmin$capacity
AEP_Plot_2_hhmin <- plot(aep_2_hhmin)

# calculate annual energy production with maximum hub height
aep_2_hhmax <- aep(profile = pf, pc = pc_2, hub.h = hh2_max) 
capacity_2_hhmax <- aep_2_hhmax$capacity
AEP_Plot_2_hhmax <- plot(aep_2_hhmax)

# plot energy production over typical day


```

#### Enercon E82
```{r}
# Power curve 
pc_3 <- pc(Power_Curves$PC_File[3])
plot(pc_3, cp=TRUE, ct=TRUE)

# Hub Height min & max
hh3_min <- Power_Curves$HH_min_m[3]
hh3_max <- Power_Curves$HH_max_m[3]

# calculate annual energy production with minimum hub height
aep_3_hhmin <- aep(profile = pf, pc = pc_3, hub.h = hh3_min) 
capacity_3_hhmin <- aep_3_hhmin$capacity
AEP_Plot_3_hhmin <- plot(aep_3_hhmin)

# calculate annual energy production with maximum hub height
aep_3_hhmax <- aep(profile = pf, pc = pc_3, hub.h = hh3_max) 
capacity_3_hhmax <- aep_3_hhmax$capacity
AEP_Plot_3_hhmax <- plot(aep_3_hhmax)

# plot energy production over typical day


```

#### Vestas V164
```{r}
# Power curve 
pc_4 <- pc(Power_Curves$PC_File[4])
plot(pc_4, cp=TRUE, ct=TRUE)

# Hub Height min & max
hh4_min <- Power_Curves$HH_min_m[4]
hh4_max <- Power_Curves$HH_max_m[4]

# calculate annual energy production with minimum hub height
aep_4_hhmin <- aep(profile = pf, pc = pc_4, hub.h = hh4_min) 
capacity_4_hhmin <- aep_4_hhmin$capacity
AEP_Plot_4_hhmin <- plot(aep_4_hhmin)

# calculate annual energy production with maximum hub height
aep_4_hhmax <- aep(profile = pf, pc = pc_4, hub.h = hh4_max) 
capacity_4_hhmax <- aep_4_hhmax$capacity
AEP_Plot_4_hhmax <- plot(aep_4_hhmax)

# plot energy production over typical day


```

#### Vestas V90
```{r}
# Power curve 
pc_5 <- pc(Power_Curves$PC_File[5])
plot(pc_5, cp=TRUE, ct=TRUE)

# Hub Height min & max
hh5_min <- Power_Curves$HH_min_m[5]
hh5_max <- Power_Curves$HH_max_m[5]

# calculate annual energy production with minimum hub height
aep_5_hhmin <- aep(profile = pf, pc = pc_5, hub.h = hh5_min) 
capacity_5_hhmin <- aep_5_hhmin$capacity
AEP_Plot_5_hhmin <- plot(aep_5_hhmin)

# calculate annual energy production with maximum hub height
aep_5_hhmax <- aep(profile = pf, pc = pc_5, hub.h = hh5_max) 
capacity_5_hhmax <- aep_5_hhmax$capacity
AEP_Plot_5_hhmax <- plot(aep_5_hhmax)

# plot energy production over typical day


```

#### Vestas V112
```{r}
# Power curve 
pc_6 <- pc(Power_Curves$PC_File[6])
plot(pc_6, cp=TRUE, ct=TRUE)

# Hub Height min & max
hh6_min <- Power_Curves$HH_min_m[6]
hh6_max <- Power_Curves$HH_max_m[6]

# calculate annual energy production with minimum hub height
aep_6_hhmin <- aep(profile = pf, pc = pc_6, hub.h = hh6_min) 
capacity_6_hhmin <- aep_6_hhmin$capacity
AEP_Plot_6_hhmin <- plot(aep_6_hhmin)

# calculate annual energy production with maximum hub height
aep_6_hhmax <- aep(profile = pf, pc = pc_6, hub.h = hh6_max) 
capacity_6_hhmax <- aep_6_hhmax$capacity
AEP_Plot_6_hhmax <- plot(aep_6_hhmax)

# plot energy production over typical day


```

#### Leitwind LTW101
```{r}
# Power curve 
pc_7 <- pc(Power_Curves$PC_File[7])
plot(pc_7, cp=TRUE, ct=TRUE)

# Hub Height min & max
hh7_min <- Power_Curves$HH_min_m[7]
hh7_max <- Power_Curves$HH_max_m[7]

# calculate annual energy production with minimum hub height
aep_7_hhmin <- aep(profile = pf, pc = pc_7, hub.h = hh7_min) 
capacity_7_hhmin <- aep_7_hhmin$capacity
AEP_Plot_7_hhmin <- plot(aep_7_hhmin)

# calculate annual energy production with maximum hub height
aep_7_hhmax <- aep(profile = pf, pc = pc_7, hub.h = hh7_max) 
capacity_7_hhmax <- aep_7_hhmax$capacity
AEP_Plot_7_hhmax <- plot(aep_7_hhmax)

# plot energy production over typical day


```

#### Repower 5M
```{r}
# Power curve 
pc_8 <- pc(Power_Curves$PC_File[8])
plot(pc_8, cp=TRUE, ct=TRUE)

# Hub Height min & max
hh8_min <- Power_Curves$HH_min_m[8]
hh8_max <- Power_Curves$HH_max_m[8]

# calculate annual energy production with minimum hub height
aep_8_hhmin <- aep(profile = pf, pc = pc_8, hub.h = hh8_min) 
capacity_8_hhmin <- aep_8_hhmin$capacity
AEP_Plot_8_hhmin <- plot(aep_8_hhmin)

# calculate annual energy production with maximum hub height
aep_8_hhmax <- aep(profile = pf, pc = pc_8, hub.h = hh8_max) 
capacity_8_hhmax <- aep_8_hhmax$capacity
AEP_Plot_8_hhmax <- plot(aep_8_hhmax)

# plot energy production over typical day


```

#### Siemens SWT
```{r}
# Power curve 
pc_9 <- pc(Power_Curves$PC_File[9])
plot(pc_9, cp=TRUE, ct=TRUE)

# Hub Height min & max
hh9_min <- Power_Curves$HH_min_m[9]
hh9_max <- Power_Curves$HH_max_m[9]

# calculate annual energy production with minimum hub height
aep_9_hhmin <- aep(profile = pf, pc = pc_9, hub.h = hh9_min) 
capacity_9_hhmin <- aep_9_hhmin$capacity
AEP_Plot_9_hhmin <- plot(aep_9_hhmin)

# calculate annual energy production with maximum hub height
aep_9_hhmax <- aep(profile = pf, pc = pc_9, hub.h = hh9_max) 
capacity_9_hhmax <- aep_9_hhmax$capacity
AEP_Plot_9_hhmax <- plot(aep_9_hhmax)

# plot energy production over typical day


```

#### Siemens SWT
```{r}
# Power curve 
pc_1 <- pc(Power_Curves$PC_File[1])
plot(pc_1, cp=TRUE, ct=TRUE)

# Hub Height min & max
hh1_min <- Power_Curves$HH_min_m[1]
hh1_max <- Power_Curves$HH_max_m[1]

# calculate annual energy production with minimum hub height
aep_1_hhmin <- aep(profile = pf, pc = pc_1, hub.h = hh1_min) 
capacity_1_hhmin <- aep_1_hhmin$capacity
AEP_Plot_1_hhmin <- plot(aep_1_hhmin)

# calculate annual energy production with maximum hub height
aep_1_hhmax <- aep(profile = pf, pc = pc_1, hub.h = hh1_max) 
capacity_1_hhmax <- aep_1_hhmax$capacity
AEP_Plot_1_hhmax <- plot(aep_1_hhmax)

# plot energy production over typical day

```
